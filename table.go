package ztable

// ZTable ...
type ZTable struct {
	table []*ZScore
}

// ZScore ...
type ZScore struct {
	Score       float64
	Probability float64
}

// NewTable creates a new ZTable containing ZScore entries
// from a static data file (data.csv)
func NewTable() *ZTable {
	z := &ZTable{
		table: []*ZScore{
			{0.00, 0.5000000000},
			{0.01, 0.5039893563},
			{0.02, 0.5079783137},
			{0.03, 0.5119664734},
			{0.04, 0.5159534369},
			{0.05, 0.5199388058},
			{0.06, 0.5239221827},
			{0.07, 0.5279031702},
			{0.08, 0.5318813720},
			{0.09, 0.5358563926},
			{0.10, 0.5398278373},
			{0.11, 0.5437953125},
			{0.12, 0.5477584260},
			{0.13, 0.5517167867},
			{0.14, 0.5556700048},
			{0.15, 0.5596176924},
			{0.16, 0.5635594629},
			{0.17, 0.5674949317},
			{0.18, 0.5714237159},
			{0.19, 0.5753454347},
			{0.20, 0.5792597094},
			{0.21, 0.5831661635},
			{0.22, 0.5870644226},
			{0.23, 0.5909541151},
			{0.24, 0.5948348717},
			{0.25, 0.5987063257},
			{0.26, 0.6025681132},
			{0.27, 0.6064198732},
			{0.28, 0.6102612476},
			{0.29, 0.6140918812},
			{0.30, 0.6179114222},
			{0.31, 0.6217195218},
			{0.32, 0.6255158347},
			{0.33, 0.6293000189},
			{0.34, 0.6330717360},
			{0.35, 0.6368306512},
			{0.36, 0.6405764332},
			{0.37, 0.6443087548},
			{0.38, 0.6480272924},
			{0.39, 0.6517317265},
			{0.40, 0.6554217416},
			{0.41, 0.6590970262},
			{0.42, 0.6627572732},
			{0.43, 0.6664021794},
			{0.44, 0.6700314463},
			{0.45, 0.6736447797},
			{0.46, 0.6772418897},
			{0.47, 0.6808224912},
			{0.48, 0.6843863035},
			{0.49, 0.6879330506},
			{0.50, 0.6914624613},
			{0.51, 0.6949742691},
			{0.52, 0.6984682125},
			{0.53, 0.7019440346},
			{0.54, 0.7054014838},
			{0.55, 0.7088403132},
			{0.56, 0.7122602812},
			{0.57, 0.7156611510},
			{0.58, 0.7190426911},
			{0.59, 0.7224046752},
			{0.60, 0.7257468822},
			{0.61, 0.7290690962},
			{0.62, 0.7323711065},
			{0.63, 0.7356527079},
			{0.64, 0.7389137003},
			{0.65, 0.7421538892},
			{0.66, 0.7453730853},
			{0.67, 0.7485711049},
			{0.68, 0.7517477695},
			{0.69, 0.7549029063},
			{0.70, 0.7580363478},
			{0.71, 0.7611479319},
			{0.72, 0.7642375022},
			{0.73, 0.7673049077},
			{0.74, 0.7703500028},
			{0.75, 0.7733726476},
			{0.76, 0.7763727076},
			{0.77, 0.7793500537},
			{0.78, 0.7823045624},
			{0.79, 0.7852361158},
			{0.80, 0.7881446014},
			{0.81, 0.7910299121},
			{0.82, 0.7938919464},
			{0.83, 0.7967306082},
			{0.84, 0.7995458067},
			{0.85, 0.8023374569},
			{0.86, 0.8051054787},
			{0.87, 0.8078497979},
			{0.88, 0.8105703452},
			{0.89, 0.8132670570},
			{0.90, 0.8159398747},
			{0.91, 0.8185887451},
			{0.92, 0.8212136204},
			{0.93, 0.8238144578},
			{0.94, 0.8263912197},
			{0.95, 0.8289438737},
			{0.96, 0.8314723925},
			{0.97, 0.8339767539},
			{0.98, 0.8364569407},
			{0.99, 0.8389129405},
			{1.00, 0.8413447461},
			{1.01, 0.8437523550},
			{1.02, 0.8461357696},
			{1.03, 0.8484949972},
			{1.04, 0.8508300497},
			{1.05, 0.8531409436},
			{1.06, 0.8554277003},
			{1.07, 0.8576903456},
			{1.08, 0.8599289099},
			{1.09, 0.8621434280},
			{1.10, 0.8643339391},
			{1.11, 0.8665004868},
			{1.12, 0.8686431190},
			{1.13, 0.8707618878},
			{1.14, 0.8728568494},
			{1.15, 0.8749280644},
			{1.16, 0.8769755969},
			{1.17, 0.8789995156},
			{1.18, 0.8809998925},
			{1.19, 0.8829768040},
			{1.20, 0.8849303298},
			{1.21, 0.8868605536},
			{1.22, 0.8887675626},
			{1.23, 0.8906514476},
			{1.24, 0.8925123029},
			{1.25, 0.8943502263},
			{1.26, 0.8961653189},
			{1.27, 0.8979576849},
			{1.28, 0.8997274320},
			{1.29, 0.9014746710},
			{1.30, 0.9031995154},
			{1.31, 0.9049020822},
			{1.32, 0.9065824910},
			{1.33, 0.9082408643},
			{1.34, 0.9098773275},
			{1.35, 0.9114920086},
			{1.36, 0.9130850381},
			{1.37, 0.9146565492},
			{1.38, 0.9162066776},
			{1.39, 0.9177355613},
			{1.40, 0.9192433408},
			{1.41, 0.9207301585},
			{1.42, 0.9221961595},
			{1.43, 0.9236414905},
			{1.44, 0.9250663005},
			{1.45, 0.9264707404},
			{1.46, 0.9278549630},
			{1.47, 0.9292191230},
			{1.48, 0.9305633767},
			{1.49, 0.9318878820},
			{1.50, 0.9331927987},
			{1.51, 0.9344782879},
			{1.52, 0.9357445122},
			{1.53, 0.9369916355},
			{1.54, 0.9382198233},
			{1.55, 0.9394292420},
			{1.56, 0.9406200594},
			{1.57, 0.9417924444},
			{1.58, 0.9429465668},
			{1.59, 0.9440825975},
			{1.60, 0.9452007083},
			{1.61, 0.9463010719},
			{1.62, 0.9473838615},
			{1.63, 0.9484492515},
			{1.64, 0.9494974165},
			{1.65, 0.9505285320},
			{1.66, 0.9515427737},
			{1.67, 0.9525403182},
			{1.68, 0.9535213421},
			{1.69, 0.9544860227},
			{1.70, 0.9554345372},
			{1.71, 0.9563670635},
			{1.72, 0.9572837792},
			{1.73, 0.9581848624},
			{1.74, 0.9590704910},
			{1.75, 0.9599408431},
			{1.76, 0.9607960967},
			{1.77, 0.9616364296},
			{1.78, 0.9624620197},
			{1.79, 0.9632730443},
			{1.80, 0.9640696809},
			{1.81, 0.9648521064},
			{1.82, 0.9656204976},
			{1.83, 0.9663750306},
			{1.84, 0.9671158813},
			{1.85, 0.9678432252},
			{1.86, 0.9685572370},
			{1.87, 0.9692580911},
			{1.88, 0.9699459610},
			{1.89, 0.9706210200},
			{1.90, 0.9712834402},
			{1.91, 0.9719333933},
			{1.92, 0.9725710503},
			{1.93, 0.9731965811},
			{1.94, 0.9738101551},
			{1.95, 0.9744119405},
			{1.96, 0.9750021049},
			{1.97, 0.9755808147},
			{1.98, 0.9761482357},
			{1.99, 0.9767045322},
			{2.00, 0.9772498681},
			{2.01, 0.9777844056},
			{2.02, 0.9783083062},
			{2.03, 0.9788217304},
			{2.04, 0.9793248371},
			{2.05, 0.9798177846},
			{2.06, 0.9803007296},
			{2.07, 0.9807738278},
			{2.08, 0.9812372336},
			{2.09, 0.9816911001},
			{2.10, 0.9821355794},
			{2.11, 0.9825708221},
			{2.12, 0.9829969774},
			{2.13, 0.9834141933},
			{2.14, 0.9838226166},
			{2.15, 0.9842223926},
			{2.16, 0.9846136652},
			{2.17, 0.9849965770},
			{2.18, 0.9853712692},
			{2.19, 0.9857378816},
			{2.20, 0.9860965525},
			{2.21, 0.9864474189},
			{2.22, 0.9867906162},
			{2.23, 0.9871262786},
			{2.24, 0.9874545386},
			{2.25, 0.9877755273},
			{2.26, 0.9880893746},
			{2.27, 0.9883962085},
			{2.28, 0.9886961558},
			{2.29, 0.9889893417},
			{2.30, 0.9892758900},
			{2.31, 0.9895559229},
			{2.32, 0.9898295613},
			{2.33, 0.9900969244},
			{2.34, 0.9903581301},
			{2.35, 0.9906132945},
			{2.36, 0.9908625325},
			{2.37, 0.9911059574},
			{2.38, 0.9913436810},
			{2.39, 0.9915758136},
			{2.40, 0.9918024641},
			{2.41, 0.9920237397},
			{2.42, 0.9922397464},
			{2.43, 0.9924505886},
			{2.44, 0.9926563690},
			{2.45, 0.9928571893},
			{2.46, 0.9930531492},
			{2.47, 0.9932443474},
			{2.48, 0.9934308809},
			{2.49, 0.9936128452},
			{2.50, 0.9937903347},
			{2.51, 0.9939634419},
			{2.52, 0.9941322583},
			{2.53, 0.9942968737},
			{2.54, 0.9944573766},
			{2.55, 0.9946138540},
			{2.56, 0.9947663918},
			{2.57, 0.9949150743},
			{2.58, 0.9950599842},
			{2.59, 0.9952012034},
			{2.60, 0.9953388120},
			{2.61, 0.9954728889},
			{2.62, 0.9956035117},
			{2.63, 0.9957307566},
			{2.64, 0.9958546986},
			{2.65, 0.9959754115},
			{2.66, 0.9960929674},
			{2.67, 0.9962074377},
			{2.68, 0.9963188920},
			{2.69, 0.9964273990},
			{2.70, 0.9965330262},
			{2.71, 0.9966358396},
			{2.72, 0.9967359042},
			{2.73, 0.9968332837},
			{2.74, 0.9969280408},
			{2.75, 0.9970202368},
			{2.76, 0.9971099319},
			{2.77, 0.9971971854},
			{2.78, 0.9972820551},
			{2.79, 0.9973645979},
			{2.80, 0.9974448697},
			{2.81, 0.9975229250},
			{2.82, 0.9975988175},
			{2.83, 0.9976725998},
			{2.84, 0.9977443233},
			{2.85, 0.9978140385},
			{2.86, 0.9978817950},
			{2.87, 0.9979476410},
			{2.88, 0.9980116241},
			{2.89, 0.9980737909},
			{2.90, 0.9981341867},
			{2.91, 0.9981928562},
			{2.92, 0.9982498431},
			{2.93, 0.9983051900},
			{2.94, 0.9983589388},
			{2.95, 0.9984111304},
			{2.96, 0.9984618048},
			{2.97, 0.9985110013},
			{2.98, 0.9985587581},
			{2.99, 0.9986051128},
			{3.00, 0.9986501020},
			{3.01, 0.9986937616},
			{3.02, 0.9987361266},
			{3.03, 0.9987772313},
			{3.04, 0.9988171093},
			{3.05, 0.9988557932},
			{3.06, 0.9988933150},
			{3.07, 0.9989297061},
			{3.08, 0.9989649970},
			{3.09, 0.9989992175},
			{3.10, 0.9990323968},
			{3.11, 0.9990645633},
			{3.12, 0.9990957448},
			{3.13, 0.9991259685},
			{3.14, 0.9991552608},
			{3.15, 0.9991836477},
			{3.16, 0.9992111543},
			{3.17, 0.9992378053},
			{3.18, 0.9992636247},
			{3.19, 0.9992886360},
			{3.20, 0.9993128621},
			{3.21, 0.9993363251},
			{3.22, 0.9993590470},
			{3.23, 0.9993810489},
			{3.24, 0.9994023515},
			{3.25, 0.9994229750},
			{3.26, 0.9994429389},
			{3.27, 0.9994622626},
			{3.28, 0.9994809646},
			{3.29, 0.9994990631},
			{3.30, 0.9995165759},
			{3.31, 0.9995335201},
			{3.32, 0.9995499128},
			{3.33, 0.9995657701},
			{3.34, 0.9995811081},
			{3.35, 0.9995959422},
			{3.36, 0.9996102876},
			{3.37, 0.9996241591},
			{3.38, 0.9996375709},
			{3.39, 0.9996505369},
			{3.40, 0.9996630707},
			{3.41, 0.9996751856},
			{3.42, 0.9996868943},
			{3.43, 0.9996982094},
			{3.44, 0.9997091429},
			{3.45, 0.9997197067},
			{3.46, 0.9997299123},
			{3.47, 0.9997397708},
			{3.48, 0.9997492931},
			{3.49, 0.9997584897},
			{3.50, 0.9997673709},
			{3.51, 0.9997759467},
			{3.52, 0.9997842266},
			{3.53, 0.9997922202},
			{3.54, 0.9997999365},
			{3.55, 0.9998073844},
			{3.56, 0.9998145726},
			{3.57, 0.9998215094},
			{3.58, 0.9998282029},
			{3.59, 0.9998346610},
			{3.60, 0.9998408914},
			{3.61, 0.9998469015},
			{3.62, 0.9998526985},
			{3.63, 0.9998582894},
			{3.64, 0.9998636810},
			{3.65, 0.9998688798},
			{3.66, 0.9998738924},
			{3.67, 0.9998787248},
			{3.68, 0.9998833830},
			{3.69, 0.9998878730},
			{3.70, 0.9998922003},
			{3.71, 0.9998963704},
			{3.72, 0.9999003886},
			{3.73, 0.9999042601},
			{3.74, 0.9999079899},
			{3.75, 0.9999115827},
			{3.76, 0.9999150433},
			{3.77, 0.9999183762},
			{3.78, 0.9999215858},
			{3.79, 0.9999246764},
			{3.80, 0.9999276520},
			{3.81, 0.9999305166},
			{3.82, 0.9999332742},
			{3.83, 0.9999359284},
			{3.84, 0.9999384828},
			{3.85, 0.9999409411},
			{3.86, 0.9999433065},
			{3.87, 0.9999455823},
			{3.88, 0.9999477718},
			{3.89, 0.9999498779},
			{3.90, 0.9999519037},
			{3.91, 0.9999538519},
			{3.92, 0.9999557255},
			{3.93, 0.9999575271},
			{3.94, 0.9999592592},
			{3.95, 0.9999609244},
			{3.96, 0.9999625251},
			{3.97, 0.9999640637},
			{3.98, 0.9999655424},
			{3.99, 0.9999669634},
			{4.00, 0.9999683288},
			{4.01, 0.9999696406},
			{4.02, 0.9999709009},
			{4.03, 0.9999721116},
			{4.04, 0.9999732744},
			{4.05, 0.9999743912},
			{4.06, 0.9999754636},
			{4.07, 0.9999764934},
			{4.08, 0.9999774821},
			{4.09, 0.9999784313},
		}
	}

	return z
}

// Len returns the size of the ZScore collection
func (z *ZTable) Len() int {
	return len(z.table)
}

// GetFuzzy returns the neighboring zscore values given a
// defined probability (p) as a percentage in dot notation
func (z *ZTable) GetFuzzy(p float64) []*ZScore {
	var pre, cur, fut *ZScore

	for i := 0; i < z.Len(); i++ {
		pre, cur, fut = z.table[i], z.table[i], z.table[i]

		// set the previous score
		if i > 0 {
			pre = z.table[i-1]
		}

		// set the future score
		if i+1 < z.Len()-1 {
			fut = z.table[i+1]
		}

		// break if we found an exact match or the current
		// probability is higher than the one provided
		if cur.Probability == p || cur.Probability > p {
			break
		}

	}

	// debugging
	//fmt.Printf("%f | %+v %+v %+v\n", p, pre, cur, fut)
	return []*ZScore{pre, cur, fut}
}

// GetScore ...
func (z *ZTable) GetScore(p float64) float64 {
	if p > 1 {
		return 4.
	}
	s := z.GetFuzzy(p)[1].Score
	return s
}

// GetProbability ...
func (z *ZTable) GetProbability(s float64) float64 {
	zs := z.table[0]

	for i := 0; i < z.Len(); i++ {
		zs = z.table[i]

		if zs.Score >= s {
			break
		}
	}

	return zs.Probability
}
